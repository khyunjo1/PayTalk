# 카카오 알림톡 설정 가이드

## 1. 카카오 개발자 계정 설정

### 1.1 카카오 개발자 계정 생성
1. [카카오 개발자 사이트](https://developers.kakao.com/) 접속
2. 카카오 계정으로 로그인
3. 개발자 등록 완료

### 1.2 애플리케이션 생성
1. **내 애플리케이션** → **애플리케이션 추가하기**
2. **앱 이름**: PayTalk
3. **사업자명**: PayTalk
4. **카테고리**: 기타
5. **생성** 클릭

## 2. 카카오 채널 설정

### 2.1 카카오 채널 생성
1. [카카오 비즈니스](https://business.kakao.com/) 접속
2. **카카오 채널** → **채널 만들기**
3. 채널 정보 입력 및 생성

### 2.2 채널과 앱 연결
1. 카카오 개발자 사이트 → **내 애플리케이션** → **PayTalk**
2. **플랫폼** → **Web 플랫폼 등록**
3. **사이트 도메인**: `http://localhost:3000` (개발용)
4. **카카오 채널** → **채널 연결**
5. 생성한 카카오 채널 선택

## 3. Bizmessage API 설정

### 3.1 Bizmessage 서비스 신청
1. [카카오 비즈니스](https://business.kakao.com/) → **Bizmessage**
2. **서비스 신청** → **알림톡**
3. 신청서 작성 및 제출
4. 승인 대기 (보통 1-2일 소요)

### 3.2 템플릿 생성
1. **Bizmessage** → **알림톡** → **템플릿 관리**
2. **템플릿 만들기** 클릭
3. 다음 템플릿들을 생성:

#### 주문 접수 템플릿
```
[#{store_name}] 주문이 접수되었습니다

안녕하세요 #{customer_name}님!

주문번호: #{order_id}
주문내역: #{order_items}
총 금액: #{total_amount}원

#{delivery_address} #{delivery_time}에 배달 예정입니다.

입금자명: #{depositor_name}
입금계좌: #{account_holder} #{bank_account}

감사합니다.
```

#### 입금확인 템플릿
```
[#{store_name}] 입금이 확인되었습니다

안녕하세요 #{customer_name}님!

주문번호: #{order_id}
#{status_message}

#{delivery_address} #{delivery_time}에 배달 예정입니다.

감사합니다.
```

#### 배달완료 템플릿
```
[#{store_name}] 주문이 완료되었습니다

안녕하세요 #{customer_name}님!

주문번호: #{order_id}
#{status_message}

맛있게 드세요!

감사합니다.
```

#### 신규 주문 템플릿 (사장님용)
```
[#{store_name}] 새로운 주문이 들어왔습니다

주문번호: #{order_id}
고객: #{customer_name}
주문내역: #{order_items}
총 금액: #{total_amount}원

#{order_type}: #{delivery_address} #{delivery_time}

주문을 확인해주세요.
```

## 4. 환경 변수 설정

### 4.1 .env.local 파일에 추가
```env
# 카카오 알림톡 설정
VITE_KAKAO_ACCESS_TOKEN=your_kakao_access_token_here
VITE_KAKAO_CHANNEL_ID=your_channel_id_here
```

### 4.2 액세스 토큰 발급
1. 카카오 개발자 사이트 → **내 애플리케이션** → **PayTalk**
2. **앱 키** → **REST API 키** 복사
3. **제품 설정** → **카카오 로그인** → **동의항목** 설정
4. **제품 설정** → **카카오 로그인** → **Redirect URI** 설정
5. **제품 설정** → **카카오 로그인** → **고급** → **동적 생성** 활성화

## 5. 테스트

### 5.1 개발 환경에서 테스트
1. 주문 생성 시 알림톡 발송 확인
2. 주문 상태 변경 시 알림톡 발송 확인
3. 알림톡 로그 테이블에서 발송 기록 확인

### 5.2 실제 발송 테스트
1. 실제 전화번호로 테스트 주문 생성
2. 알림톡 수신 확인
3. 템플릿 변수 정상 적용 확인

## 6. 주의사항

### 6.1 템플릿 승인
- 모든 템플릿은 카카오에서 승인 후 사용 가능
- 승인 전까지는 테스트 모드로만 사용 가능

### 6.2 발송 제한
- 무료 플랜: 월 1,000건
- 유료 플랜: 월 10,000건 이상

### 6.3 전화번호 형식
- 국제 형식: +821012345678
- 국내 형식: 01012345678
- 하이픈 포함: 010-1234-5678

## 7. 문제 해결

### 7.1 알림톡 발송 실패
- 템플릿 ID 확인
- 액세스 토큰 유효성 확인
- 전화번호 형식 확인
- 채널 연결 상태 확인

### 7.2 템플릿 변수 오류
- 템플릿에 정의된 변수명과 코드의 변수명 일치 확인
- 필수 변수 누락 확인
- 변수 타입 확인 (문자열, 숫자 등)
